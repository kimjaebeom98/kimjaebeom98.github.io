---
layout: single
title: Djangoì˜ ORM
categories : django
tag : [Django]
toc : true
---

## ORM ?
<hr>

**ORM(Object-Relation Mapping)ì´ë€, `ê°ì²´(Object)`ì™€ `ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤(Relational)`ì„ ì—°ê²°(Mapping)í•´ ì£¼ëŠ”ê²ƒì„ ì˜ë¯¸**í•œë‹¤. ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ë©´, ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ì„ ê°ì²´(Object)ì™€ ì—°ê²°í•˜ì—¬ í…Œì´ë¸”ì— CRUD
í•  ë•Œ, SQL ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê°€ëŠ¥í•˜ë„ë¡ í•¨.

### 1ï¸âƒ£ ë°ì´í„° ìƒì„±(Create)
<hr>

```python
# PostëŠ” ë¸”ë¡œê·¸ ì•±ì—ì„œ ë§Œë“  í¬ìŠ¤íŠ¸ ëª¨ë¸ì´ë¼ê³  ê°€ì •
# def __str__(self)ë¡œ í•´ë‹¹ ëª¨ë¸ì˜ íƒ€ì´í‹€ì´ ë°˜í™˜ì´ ë  ê²ƒì„
Post.objects.create(author=admin, title='This is a test title', content='test content')
# ê²°ê³¼ : <Post: This is a test title>
```
### 2ï¸âƒ£ ë°ì´í„° ì¡°íšŒ(Read)
<hr>

```python
Post.objects.all()
# ê²°ê³¼ : <QuerySet [<Post: This is a test title>]>
```

### 3ï¸âƒ£ ë°ì´í„° ì—…ë°ì´íŠ¸(Update)
<hr>

```python
# í•´ë‹¹ ì œëª©ì— Post ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¨ë‹¤. 
# SELECT title From blog_post WHERE title = 'This is a test title'; ëŠë‚Œ?
post = Post.objects.get(title='This is a test title')
post.title = 'This is a test title2'
# ë³€ê²½ëœ ë‚´ìš©ì„ í…Œì´ë¸”ì— ë°˜ì˜
post.save()
```

ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ í…Œì´ë¸” ì¡°íšŒ  

```python
Post.objects.get(title__contains='title2')
# or
Post.objects.filter(title__contains='title2')
```

### 4ï¸âƒ£ ë°ì´í„° ì‚­ì œ(Delete)
<hr>
```python
post = Post.object.get(title__contains='title2')
post.delete()
```

### ì¡°íšŒì¡°ê±´ ğŸ”½
<hr>

<table><thead><tr><th>ì¡°íšŒ ì¡°ê±´</th><th>ì„¤ëª…</th><th>ì‚¬ìš© ë°©ë²•</th></tr></thead><tbody><tr><td>__contains</td><td>ì§€ì •í•œ ë¬¸ìì—´ì„ í¬í•¨í•˜ëŠ” ë°ì´í„° ì¡°íšŒ</td><td>Post.objects.filter(title__contains=â€™testâ€™)</td></tr><tr><td>__icontains</td><td>ì§€ì •í•œ ë¬¸ìì—´ì˜ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ì—†ì´ í¬í•¨í•˜ëŠ” ë°ì´í„° ì¡°íšŒ</td><td>Post.objects.filter(title__icontains=â€™thisâ€™)</td></tr><tr><td>__lt</td><td>ê°’ì´ ì‘ì€ ê²½ìš°(lt: less than)</td><td>Post.objects.filter(published_at__lt=timezone.now())</td></tr><tr><td>__lte</td><td>ê°’ì´ ì‘ê±°ë‚˜ ê°™ì€ ê²½ìš°(lte: less than or equal)</td><td>Post.objects.filter(published_at__lt=timezone.now())</td></tr><tr><td>__gt</td><td>ê°’ì´ í° ê²½ìš°(gt: greater than)</td><td>Post.objects.filter(published_at__gt=timezone.now())</td></tr><tr><td>__gte</td><td>ê°’ì´ í¬ê±°ë‚˜ ê°™ì€ ê²½ìš°(gt: greater than or equal)</td><td>Post.objects.filter(published_at__gte=timezone.now())</td></tr><tr><td>__in</td><td>ì£¼ì–´ì§„ ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ë˜ëŠ” ë°ì´í„° ì¡°íšŒ</td><td>Post.objects.filter(id__in=[1, 2, 3])</td></tr><tr><td>__year</td><td>í•´ë‹¹ ë…„ë„ ì¡°íšŒ</td><td>Post.objects.filter(created_at__year=â€™2019â€™)</td></tr><tr><td>__year</td><td>í•´ë‹¹ ì›”ë¡œ ì¡°íšŒ</td><td>Post.objects.filter(created_at__month=â€™5â€™)</td></tr><tr><td>__day</td><td>í•´ë‹¹ ì¼ë¡œ ì¡°íšŒ</td><td>Post.objects.filter(created_at__day=â€™21â€™)</td></tr><tr><td>__isnull</td><td>í•´ë‹¹ ì—´ì´ nullì¸ ë°ì´í„° ì¡°íšŒ</td><td>Post.objects.filter(published_at__isnull=True)</td></tr><tr><td>__startswith</td><td>í•´ë‹¹ ë¬¸ìì—´ë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ì¡°íšŒ</td><td>Post.objects.filter(title__startswith=â€™Thisâ€™)</td></tr><tr><td>__istartswith</td><td>ëŒ€ì†Œë¬¸ìë¥¼ ê°€ë¦¬ì§€ ì•Šê³  í•´ë‹¹ ë¬¸ìì—´ë¡œ ì‹œì‘í•˜ëŠ” ë°ì´í„° ì¡°íšŒ</td><td>Post.objects.filter(title__istartswith=â€™thisâ€™)</td></tr><tr><td>__endswith</td><td>í•´ë‹¹ ë¬¸ìì—´ë¡œ ëë‚˜ëŠ” ë°ì´í„° ì¡°íšŒ</td><td>Post.objects.filter(title__endswith=â€™titleâ€™)</td></tr><tr><td>__iendswith</td><td>ëŒ€ì†Œë¬¸ìë¥¼ ê°€ë¦¬ì§€ ì•Šê³  í•´ë‹¹ ë¬¸ìì—´ë¡œ ëë‚˜ëŠ” ë°ì´í„° ì¡°íšŒ</td><td>Post.objects.filter(title__iendswith=â€™titleâ€™)</td></tr><tr><td>__range</td><td>ë²”ìœ„ë¥¼ ì§€ì •í•˜ì—¬ ì¡°íšŒ(sqlì˜ between)</td><td>Post.objects.filter(id__range=(1, 10))</td></tr></tbody></table>


- ì œì™¸ ì¡°ê±´ : íŠ¹ì • ì¡°ê±´ì„ ì œì™¸í•œ ë°ì´í„°ë¥¼ ì¡°íšŒ ê°€ëŠ¥

```python 
Post.objects.all().exclude(title__contains='This')
```
- ì—¬ëŸ¬ ì¡°ê±´ìœ¼ë¡œ ì¡°íšŒ : ì—¬ëŸ¬ ì¡°ê±´ì„ ê±¸ì–´ ë°ì´í„°ë¥¼ ì¡°íšŒ 

```python
Post.objects.filter(title__contains='this', title__endswith='title')
# thisë¥¼ í¬í•¨í•˜ëŠ” ì œëª©ì˜ Post ëª¨ë¸ë“¤ë¡œ í•„í„°ë¥¼ í•˜ê³  ë˜ ê±°ê¸°ì„œ titleì„ í¬í•¨í•˜ê³  ìˆëŠ” Post ëª¨ë¸ë¡œ ë¶„ë¦¬
Post.objects.filter(title__contains='this').filter(title__endswith='title')
# thisë¥¼ í¬í•¨í•˜ëŠ” ì—¬ëŸ¬ê°œì˜ Postë“¤ì„ ìŠ¬ë¼ì´ì‹±
Post.objects.filter(title__contains='this')[:2]
```

### ì •ë ¬ ğŸ”½
<hr>

ì•„ë˜ì™€ ê°™ì´ ì¡°íšŒí•  ë°ì´í„°ë¥¼ ì˜¤ë¦„ì°¨ìˆœ ë˜ëŠ” ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•  ìˆ˜ ìˆìŒ

- **ì˜¤ë¦„ì°¨ìˆœ** : Post.objects.order_by('created_at')
- **ë‚´ë¦¼ì°¨ìˆœ** : Post.objects.order_by('-created_at')
