---
layout: single
title: FetchTypeì´ë€?
categories: spring-boot
tag: [Spring-Boot]
toc: true
---

## FetchType ğŸ¤” ?

<hr>

ìë°”ì—ì„œ DBì™€ì˜ ìƒí˜¸ ì‘ìš©ì„ ìœ„í•´ ìë°” í¼ì‹œìŠ¤í„´ìŠ¤ API(JPA)ë¥¼ ì‚¬ìš©í•  ë•Œ, `FetchType`ì€ **ì—”í„°í‹° ê°„ì˜ ì—°ê´€ ê´€ê³„ë¥¼ ì •ì˜í•  ë•Œ ì‚¬ìš©**í•œë‹¤.

- ì—”í„°í‹° ê°„ì˜ ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ ë˜ì–´ ìˆìœ¼ë©´(FK) ê·¸ í•œ ì—”í„°í‹°ë¥¼ ì¡°íšŒì‹œ ë‹¤ë¥¸ ì—”í„°í‹°ë¥¼ ì¡°íšŒí•˜ê²Œ ë˜ëŠ”ë°, ì´ë•Œ **ë‹¤ë¥¸ ì—”í„°í‹°ë¥¼ ì–´ë–»ê²Œ ë¶ˆëŸ¬ì˜¬ ê²ƒì¸ê°€**ë¥¼ ì„¤ì •
- JPAì—ì„œëŠ” ë‘ ê°€ì§€ `FetchType`ì´ ìˆë‹¤. **EAGER** OR **LAZY**
- **EAGER** : ì—°ê´€ëœ ì—”í„°í‹°ë¥¼ ì¦‰ì‹œ ë¡œë”©. ë”°ë¼ì„œ í•´ë‹¹ ì—”í„°í‹°ê°€ ë¡œë“œë˜ëŠ” ì‹œì ì— ì—°ê´€ëœ ì—”í„°í‹°ë„ í•¨ê»˜ ë¡œë“œ
  > ì˜ˆë¥¼ ë“¤ì–´, ê²Œì‹œíŒ í”„ë¡œì íŠ¸ì—ì„œ ê²Œì‹œë¬¼(Board)ì™€ ëŒ“ê¸€(Reply)ê°€ ì—°ê´€ê´€ê³„ê°€ ìˆë‹¤ê³  í•  ë•Œ í•œ ê²Œì‹œë¬¼ ìƒì„¸ë³´ê¸°í™”ë©´ì—ì„œ ê²Œì‹œë¬¼ê³¼ ëŒ“ê¸€ ëª¨ë‘ í•œêº¼ë²ˆì— ë³´ì—¬ì§ˆ ë•Œ ì‚¬ìš©ê°€ëŠ¥
- **LAZY** : ì—°ê´€ëœ ì—”í„°í‹°ëŠ” ì‹¤ì œë¡œ ì‚¬ìš©ë  ë•Œê¹Œì§€ ë¡œë”©ë˜ì§€ ì•ŠìŒ. ë”°ë¼ì„œ ì—°ê´€ëœ ì—”í„°í‹°ê°€ í•„ìš”í•œ ì‹œì ì— ë¡œë”©ë˜ì–´ ì„±ëŠ¥ì„ ìµœì í™”í•¨.

  > ì˜ˆë¥¼ ë“¤ì–´, ê²Œì‹œíŒ í”„ë¡œì íŠ¸ì—ì„œ ê²Œì‹œë¬¼(Board)ì™€ ëŒ“ê¸€(Reply)ê°€ ì—°ê´€ê´€ê³„ê°€ ìˆë‹¤ê³  í•  ë•Œ í•œ ê²Œì‹œë¬¼ ìƒì„¸ë³´ê¸°í™”ë©´ì—ì„œ ê²Œì‹œë¬¼ì€ ë¨¼ì € ë¶ˆëŸ¬ì™€ì§€ê³  ëŒ“ê¸€ì„ í¼ì³ë³´ê¸° ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ ë°”ë¡œ ë³´ì—¬ì§ˆ í•„ìš”ê°€ ì—†ì„ ë•Œ ì‚¬ìš©ê°€ëŠ¥

- **JPA FetchType defaultê°’**ì€ `@xxToOne : EAGER`, `@xxToMany : LAZY`

### 1. EAGER (ì¦‰ì‹œë¡œë”©)

<hr>

ë‹¤ìŒê³¼ ê°™ì´ Member ì—”í„°í‹°ì™€ Team ì—”í„°í‹°ê°€ N:1 ë§¤í•‘ìœ¼ë¡œ ê´€ê³„ë¥¼ ë§ºê³  ìˆë‹¤.

```java
@Entity
public class Member {

    @Id @GeneratedValue
    private Long id;
    private String username;

    @ManyToOne(fetch = FetchType.EAGER) //Teamì„ ì¡°íšŒí•  ë•Œ ì¦‰ì‹œë¡œë”©ì„ ì‚¬ìš©í•˜ê³˜ë‹¤!
    @JoinColumn(name = "team_id")
    Team team;
}

@Entity
public class Team {

    @Id @GeneratedValue
    private Long id;
    private String teamname;
}

```

JPQLë¡œ Member 1ê±´ ì¡°íšŒ

```java
Member findMember = em.createQuery("select m from Member m", Member.class).getSingleResult();
```

ì‹¤ì œ SQL ì½”ë“œ

```sql
//ë©¤ë²„ë¥¼ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬
select
    member0_.id as id1_0_,
    member0_.team_id as team_id3_0_,
    member0_.username as username2_0_
from
    Member member0_

//íŒ€ì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬
select
    team0_.id as id1_3_0_,
    team0_.name as name2_3_0_
from
    Team team0_
where
    team0_.id=?

```

ë‹¤ìŒê³¼ ê°™ì´ ì¦‰ì‹œ ë¡œë”©(EAGER) ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ Memberë¥¼ ì¡°íšŒí•˜ëŠ” ì‹œì ì— ë°”ë¡œ Teamê¹Œì§€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¿¼ë¦¬ë¥¼ ë‚ ë ¤ í•œêº¼ë²ˆì— ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

### 2. EAGER (ì¦‰ì‹œë¡œë”©)

ì•„ë˜ì™€ ê°™ì´ ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•˜ê³  Memberë¥¼ ì¡°íšŒí•´ë³´ë©´ ì¦‰ì‹œ ë¡œë”© ë°©ì‹ê³¼ ë‹¬ë¦¬ Teamì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ê°€ ìƒì„±ë˜ì§€ ì•Šê³  Memberë¥¼ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ë§Œ ë‚˜ê°€ê³ , ì‹¤ì œë¡œ íŒ€ì„ ì‚¬ìš©í•˜ëŠ” ì‹œì ì— Teamì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ê°€ ë‚˜ê°„ë‹¤.

```java

 @ManyToOne(fetch = FetchType.LAZY) //Teamì„ ì¡°íšŒí•  ë•Œ ì§€ì—°ë¡œë”©ì„ ì‚¬ìš©í•˜ê³˜ë‹¤!
 @JoinColumn(name = "team_id")
 Team team;
```

JPQLë¡œ Memberì¡°íšŒ

```java
Member findMember = em.createQuery("select m from Member m", Member.class).getSingleResult();

```

ì‹¤ì œ SQL ì½”ë“œ

```sql
//Teamì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ê°€ ë‚˜ê°€ì§€ ì•ŠìŒ!
select
    member0_.id as id1_0_,
    member0_.team_id as team_id3_0_,
    member0_.username as username2_0_
from
    Member member0_
```

**ì§€ì—° ë¡œë”©**ì„ ì‚¬ìš©í•˜ë©´ **Memberë¥¼ ì¡°íšŒí•˜ëŠ” ì‹œì ì´ ì•„ë‹Œ ì‹¤ì œ Teamì„ ì‚¬ìš©í•˜ëŠ” ì‹œì ì— ì¿¼ë¦¬ê°€ ë‚˜ê°€ë„ë¡ í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì **ì´ ìˆë‹¤.

ìœ„ ì˜ˆì œì˜ ì¦‰ì‹œ ë¡œë”©ì—ì„œëŠ” Memberì™€ ì—°ê´€ëœ Teamì´ 1ê°œì—¬ì„œ Teamì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ê°€ 1ê°œ ë‚˜ê°”ì§€ë§Œ, ë§Œì•½ Memberë¥¼ ì¡°íšŒí•˜ëŠ” JPQLì„ ë‚ ë ¸ëŠ”ë° ì—°ê´€ëœ Teamì´ 1000ê°œë¼ë©´? Memberë¥¼ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ ë‚ ë ¸ì„ ë¿ì¸ë° Teamì„ ì¡°íšŒí•˜ëŠ” SQL ì¿¼ë¦¬ 1000ê°œê°€ ì¶”ê°€ë¡œ ë‚˜ê°€ê²Œ ëœë‹¤.

ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê°€ê¸‰ì ì´ë©´ **ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.**
